<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">
    <h2 class="text-center">Task Manager</h2>
    
    <!-- Task Form -->
    <div class="card p-3 mb-3">
        <h4>Add Task</h4>
        <input type="text" id="title" class="form-control mb-2" placeholder="Title" required>
        <textarea id="description" class="form-control mb-2" placeholder="Description"></textarea>
        <input type="datetime-local" id="deadline" class="form-control mb-2" required>
        <select id="priority" class="form-control mb-2">
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
        </select>
        <button class="btn btn-success" onclick="addTask()">Add Task</button>
    </div>

    <!-- Task List -->
    <h4>Task List</h4>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Deadline</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="task-list"></tbody>
    </table>

    <script>
        const apiUrl = 'http://127.0.0.1:5000/tasks';

        async function fetchTasks() {
            const response = await fetch(apiUrl);
            const tasks = await response.json();
            const taskList = document.getElementById("task-list");
            taskList.innerHTML = "";
            tasks.forEach(task => {
                taskList.innerHTML += `
                    <tr>
                        <td>${task.title}</td>
                        <td>${task.description}</td>
                        <td>${new Date(task.deadline).toLocaleString()}</td>
                        <td>${task.priority}</td>
                        <td>${task.status}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteTask(${task.id})">Delete</button>
                        </td>
                    </tr>`;
            });
        }

        async function addTask() {
            const title = document.getElementById("title").value;
            const description = document.getElementById("description").value;
            const deadline = document.getElementById("deadline").value;
            const priority = document.getElementById("priority").value;
            
            const response = await fetch(apiUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title, description, deadline, priority })
            });
            if (response.ok) fetchTasks();
        }

        async function deleteTask(id) {
            await fetch(`${apiUrl}/${id}`, { method: "DELETE" });
            fetchTasks();
        }

        window.onload = fetchTasks;
    </script>
</body>
</html>
